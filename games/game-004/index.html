<!doctype html>
<html lang="en">
<head>

<link rel="stylesheet" href="../../assets/themes.css">
<link rel="stylesheet" href="../../assets/shell.css">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Game 004 — Keyboard Dodger</title>
<style>
:root{--bg:#0f172a;--panel:#111827;--card:#1f2937;--text:#e5e7eb;--muted:#94a3b8;--accent:#60a5fa;--good:#10b981;--bad:#ef4444}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg),#020617);color:var(--text);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial}
header{padding:18px 16px;border-bottom:1px solid rgba(255,255,255,.08);background:rgba(17,24,39,.6);backdrop-filter: blur(6px)}
h1{margin:0;font-size:18px;letter-spacing:.3px}
p{margin:8px 0 0;color:var(--muted)}
main{padding:16px;max-width:980px;margin:0 auto}
.card{background:rgba(31,41,55,.75);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
button,input,select{font:inherit}
button{background:var(--accent);border:0;color:#081225;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:700}
button.secondary{background:transparent;border:1px solid rgba(255,255,255,.16);color:var(--text)}
.badge{display:inline-flex;align-items:center;gap:8px;color:var(--muted);font-size:12px}
.kbd{border:1px solid rgba(255,255,255,.2);padding:2px 8px;border-radius:8px;background:rgba(2,6,23,.5)}
.grid{display:grid;gap:10px}
@media (min-width:780px){.grid{grid-template-columns:1.2fr .8fr}}

</style>
</head>
<body>
<header>
  <h1>Game 004 — Keyboard Dodger</h1>
  <p>Move the square with arrow keys. Avoid the falling blocks for 30 seconds.</p>
</header>
<main class="grid">
  <section class="card">
    
<div class="row">
  <button id="play">Play</button>
  <div class="badge">Time: <span id="t">30</span>s</div>
  <div class="badge">Hits: <span id="hits">0</span></div>
</div>
<div id="arena" style="position:relative;margin-top:14px;height:360px;border-radius:16px;border:1px solid rgba(255,255,255,.08);overflow:hidden;background:rgba(2,6,23,.25)"></div>

  </section>
  <aside class="card">
    <div class="badge"><span class="kbd">Tip</span><span>Open DevTools Console to see logs.</span></div>
    <hr style="border:0;border-top:1px solid rgba(255,255,255,.08);margin:12px 0"/>
    <div id="stats" class="row" style="gap:10px"></div>
    <p style="margin-top:10px" id="how"></p>
  </aside>
</main>
<script>
console.log("Game 004 — Keyboard Dodger loaded");
// Game variation seed: 4

const $=s=>document.querySelector(s);
const arena=$("#arena"), play=$("#play"), tEl=$("#t"), hitsEl=$("#hits"), stats=$("#stats"), how=$("#how");
how.textContent="Arrows move. Survive 30 seconds. Touching a block counts as a hit.";
stats.innerHTML='<span class="badge">Best: <span id="best">30</span>s</span>';
let player, blocks=[], running=false, time=30, hits=0, loop=null, sec=null, best=30;
const size=28;
function rect(el){const r=el.getBoundingClientRect(); const a=arena.getBoundingClientRect(); return {x:r.left-a.left,y:r.top-a.top,w:r.width,h:r.height};}
function collide(a,b){return a.x<a.x+b.w && a.x+a.w>b.x && a.y<a.y+b.h && a.y+a.h>b.y;} // (fixed below)
function collide2(A,B){return A.x<B.x+B.w && A.x+A.w>B.x && A.y<B.y+B.h && A.y+A.h>B.y;}
function reset(){
  arena.innerHTML=""; blocks=[]; time=30; hits=0;
  tEl.textContent=time; hitsEl.textContent=hits;
  player=document.createElement("div");
  player.style.position="absolute"; player.style.width=size+"px"; player.style.height=size+"px";
  player.style.left=(arena.clientWidth/2-size/2)+"px"; player.style.top=(arena.clientHeight-50)+"px";
  player.style.borderRadius="10px"; player.style.background="rgba(96,165,250,.9)";
  arena.appendChild(player);
}
function spawn(){
  const b=document.createElement("div");
  b.style.position="absolute"; b.style.width=(18+Math.random()*34)+"px"; b.style.height=(18+Math.random()*34)+"px";
  b.style.left=(Math.random()*(arena.clientWidth-60))+"px"; b.style.top="-40px";
  b.style.borderRadius="12px"; b.style.background="rgba(239,68,68,.65)";
  b.dataset.v=(1.3+Math.random()*2.5).toFixed(2);
  arena.appendChild(b); blocks.push(b);
}
function stop(){
  running=false; play.disabled=false;
  clearInterval(sec); sec=null; cancelAnimationFrame(loop); loop=null;
  const survived=30-time;
  const score=30-time;
  if(score>best){best=score; $("#best").textContent=best;}
}
function step(){
  if(!running) return;
  if(Math.random()<0.08) spawn();
  const pr=rect(player);
  blocks.forEach((b)=>{
    b.style.top=(parseFloat(b.style.top)+parseFloat(b.dataset.v))+"px";
    const br=rect(b);
    if(collide2(pr,br)){
      hits++; hitsEl.textContent=hits;
      b.style.background="rgba(239,68,68,.25)";
    }
  });
  blocks=blocks.filter(b=>{
    if(parseFloat(b.style.top)>arena.clientHeight+50){b.remove(); return false;}
    return true;
  });
  loop=requestAnimationFrame(step);
}
document.addEventListener("keydown",(e)=>{
  if(!running) return;
  const x=parseFloat(player.style.left), y=parseFloat(player.style.top);
  const step=16;
  if(e.key==="ArrowLeft") player.style.left=Math.max(0,x-step)+"px";
  if(e.key==="ArrowRight") player.style.left=Math.min(arena.clientWidth-size,x+step)+"px";
  if(e.key==="ArrowUp") player.style.top=Math.max(0,y-step)+"px";
  if(e.key==="ArrowDown") player.style.top=Math.min(arena.clientHeight-size,y+step)+"px";
});
play.addEventListener("click",()=>{
  if(running) return;
  reset(); running=true; play.disabled=true;
  sec=setInterval(()=>{time--; tEl.textContent=time; if(time<=0) stop();},1000);
  step();
});
reset();

</script>

<script type="application/json" id="game-meta">{"number": "004", "title": "Game 004 — Keyboard Dodger", "concept": "DOM + Events", "whatsDifferent": "Same core pattern as the last game, but with a new rule or constraint to strengthen the skill.", "challengeVariants": ["Add a reset button", "Add a score multiplier toggle", "Add a win condition message"], "theme": "theme-neon", "prev": "003", "next": "005"}</script>

<script src="../../assets/shell.js"></script>
</body>
</html>